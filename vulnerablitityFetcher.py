import requests
from prettytable import PrettyTable

# import json
# URL = 'https://services.nvd.nist.gov/rest/json/cves/2.0'
# cpe = 'cpe:2.3:a:apache:http_server:2.4.58'
# PARAMS= {'cpeName':cpeStr}

# r = requests.get(url = URL,  params = PARAMS)
# data = r.json()

# # f = open('res.json', 'w')
# # f.write(r.text)
# # f.close()
# # f= open('res.json', 'r')
# # data = json.load(f)
# # f.close()

# table= PrettyTable()
# table.field_names = ["ID", "Base Severity", "Exploitability Score", "Impact Score"]

# for vul in data['vulnerabilities']:
#     cveId = vul['cve']['id']
#     cveDesc = vul['cve']['descriptions'][0]['value']
#     cveBaseSeverity= vul['cve']['metrics']['cvssMetricV2'][0]['baseSeverity']
#     cveExploitabilityScore = vul['cve']['metrics']['cvssMetricV2'][0]['exploitabilityScore']
#     cveImpactScore= vul['cve']['metrics']['cvssMetricV2'][0]['impactScore']
#     if cveImpactScore > 5:
#         table.add_row([cveId, cveBaseSeverity, cveExploitabilityScore, cveImpactScore])
    
# print(table)

def fetchVulerabilityInfo(cpe):
    URL = 'https://services.nvd.nist.gov/rest/json/cves/2.0'
    cpeStr = 'cpe:2.3:'+cpe[5:]
    PARAMS= {'cpeName':cpeStr}
    r = requests.get(url = URL,  params = PARAMS)
    data = r.json()
    table= PrettyTable()
    table.field_names = ["ID", "Base Severity", "Exploitability Score", "Impact Score"]

    for vul in data['vulnerabilities']:
        cveId = vul['cve']['id']
        cveDesc = vul['cve']['descriptions'][0]['value']
        cveBaseSeverity= vul['cve']['metrics']['cvssMetricV2'][0]['baseSeverity']
        cveExploitabilityScore = vul['cve']['metrics']['cvssMetricV2'][0]['exploitabilityScore']
        cveImpactScore= vul['cve']['metrics']['cvssMetricV2'][0]['impactScore']
        if cveImpactScore > 5:
            table.add_row([cveId, cveBaseSeverity, cveExploitabilityScore, cveImpactScore])
        
    print(table)

# fetchVulerabilityInfo('cpe:/a:apache:http_server:2.4.58')
